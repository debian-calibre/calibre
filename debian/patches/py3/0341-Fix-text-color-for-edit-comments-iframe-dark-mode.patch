From 3713ebc24d1898f540a9154b769137ff5ca64097 Mon Sep 17 00:00:00 2001
From: Kovid Goyal <kovid@kovidgoyal.net>
Date: Sat, 8 Aug 2020 10:18:00 +0530
Subject: [PATCH 341/408] Fix text color for edit comments iframe dark mode

---
 src/pyj/book_list/comments_editor.pyj | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/pyj/book_list/comments_editor.pyj b/src/pyj/book_list/comments_editor.pyj
index 767aa04ac8..1f3edea406 100644
--- a/src/pyj/book_list/comments_editor.pyj
+++ b/src/pyj/book_list/comments_editor.pyj
@@ -5,7 +5,7 @@ from __python__ import bound_methods, hash_literals
 from elementmaker import E
 from gettext import gettext as _
 
-from book_list.theme import get_color
+from book_list.theme import get_color, get_color_as_rgba
 from dom import add_extra_css, build_rule, clear, ensure_id, svgicon
 from iframe_comm import IframeClient, IframeWrapper
 from modals import create_custom_dialog
@@ -319,6 +319,7 @@ class CommentsEditorBoss:
             console.log(error_object)
 
     def set_html(self, data):
+        document.body.style.color = data.color
         document.body.lastChild.innerHTML = data.html
 
     def get_html(self, data):
@@ -390,7 +391,8 @@ class Editor:
         if not self.ready:
             self.pending_set_html = html
             return
-        self.iframe_wrapper.send_message('set_html', html=html)
+        rgba = get_color_as_rgba('window-foreground')
+        self.iframe_wrapper.send_message('set_html', html=html, color=f'rgba({rgba[0]},{rgba[1]},{rgba[2]},{rgba[3]})')
 
     def get_html(self, proceed):
         self.get_html_callbacks.push(proceed)
-- 
2.28.0

