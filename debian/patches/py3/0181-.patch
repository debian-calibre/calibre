From 2b26fc72fd4fbaa5906bec766bbcdad819f2e342 Mon Sep 17 00:00:00 2001
From: Kovid Goyal <kovid@kovidgoyal.net>
Date: Fri, 10 Jul 2020 12:30:59 +0530
Subject: [PATCH 181/201] ...

---
 src/calibre/gui2/viewer/config.py   | 6 ++++++
 src/calibre/gui2/viewer/main.py     | 2 +-
 src/calibre/gui2/viewer/toolbars.py | 3 ++-
 src/calibre/gui2/viewer/ui.py       | 5 ++---
 src/calibre/gui2/viewer/web_view.py | 6 ------
 5 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/src/calibre/gui2/viewer/config.py b/src/calibre/gui2/viewer/config.py
index 5269b7c35c..ec801591ad 100644
--- a/src/calibre/gui2/viewer/config.py
+++ b/src/calibre/gui2/viewer/config.py
@@ -16,3 +16,9 @@ vprefs.defaults['main_window_state'] = None
 vprefs.defaults['main_window_geometry'] = None
 vprefs.defaults['old_prefs_migrated'] = False
 vprefs.defaults['bookmarks_sort'] = 'title'
+
+
+def get_session_pref(name, default=None, group='standalone_misc_settings'):
+    sd = vprefs['session_data']
+    g = sd.get(group, {}) if group else sd
+    return g.get(name, default)
diff --git a/src/calibre/gui2/viewer/main.py b/src/calibre/gui2/viewer/main.py
index a428273320..c5a9b0a29f 100644
--- a/src/calibre/gui2/viewer/main.py
+++ b/src/calibre/gui2/viewer/main.py
@@ -15,7 +15,7 @@ from calibre import as_unicode, prints
 from calibre.constants import FAKE_PROTOCOL, VIEWER_APP_UID, islinux, iswindows
 from calibre.gui2 import Application, error_dialog, setup_gui_option_parser
 from calibre.gui2.viewer.ui import EbookViewer, is_float
-from calibre.gui2.viewer.web_view import get_session_pref, vprefs
+from calibre.gui2.viewer.config import get_session_pref, vprefs
 from calibre.ptempfile import reset_base_dir
 from calibre.utils.config import JSONConfig
 from calibre.utils.ipc import RC, viewer_socket_address
diff --git a/src/calibre/gui2/viewer/toolbars.py b/src/calibre/gui2/viewer/toolbars.py
index 0590ba6886..9528a9149c 100644
--- a/src/calibre/gui2/viewer/toolbars.py
+++ b/src/calibre/gui2/viewer/toolbars.py
@@ -14,8 +14,9 @@ from PyQt5.QtWebEngineWidgets import QWebEnginePage
 
 from calibre.constants import in_develop_mode, isosx
 from calibre.gui2 import elided_text
+from calibre.gui2.viewer.config import get_session_pref
 from calibre.gui2.viewer.shortcuts import index_to_key_sequence
-from calibre.gui2.viewer.web_view import get_session_pref, set_book_path, vprefs
+from calibre.gui2.viewer.web_view import set_book_path, vprefs
 from calibre.gui2.widgets2 import Dialog
 from calibre.utils.icu import primary_sort_key
 from polyglot.builtins import iteritems
diff --git a/src/calibre/gui2/viewer/ui.py b/src/calibre/gui2/viewer/ui.py
index fab78b8d02..3e3e4e5945 100644
--- a/src/calibre/gui2/viewer/ui.py
+++ b/src/calibre/gui2/viewer/ui.py
@@ -28,6 +28,7 @@ from calibre.gui2.viewer.annotations import (
     AnnotationsSaveWorker, annotations_dir, parse_annotations
 )
 from calibre.gui2.viewer.bookmarks import BookmarkManager
+from calibre.gui2.viewer.config import get_session_pref, vprefs
 from calibre.gui2.viewer.convert_book import clean_running_workers, prepare_book
 from calibre.gui2.viewer.highlights import HighlightsPanel
 from calibre.gui2.viewer.integration import (
@@ -38,9 +39,7 @@ from calibre.gui2.viewer.overlay import LoadingOverlay
 from calibre.gui2.viewer.search import SearchPanel
 from calibre.gui2.viewer.toc import TOC, TOCSearch, TOCView
 from calibre.gui2.viewer.toolbars import ActionsToolBar
-from calibre.gui2.viewer.web_view import (
-    WebView, get_path_for_name, get_session_pref, set_book_path, vprefs
-)
+from calibre.gui2.viewer.web_view import WebView, get_path_for_name, set_book_path
 from calibre.utils.date import utcnow
 from calibre.utils.img import image_from_path
 from calibre.utils.ipc.simple_worker import WorkerError
diff --git a/src/calibre/gui2/viewer/web_view.py b/src/calibre/gui2/viewer/web_view.py
index 6364c821b3..069a859ec3 100644
--- a/src/calibre/gui2/viewer/web_view.py
+++ b/src/calibre/gui2/viewer/web_view.py
@@ -200,12 +200,6 @@ class UrlSchemeHandler(QWebEngineUrlSchemeHandler):
 # }}}
 
 
-def get_session_pref(name, default=None, group='standalone_misc_settings'):
-    sd = vprefs['session_data']
-    g = sd.get(group, {}) if group else sd
-    return g.get(name, default)
-
-
 def create_profile():
     ans = getattr(create_profile, 'ans', None)
     if ans is None:
-- 
2.28.0.rc0

