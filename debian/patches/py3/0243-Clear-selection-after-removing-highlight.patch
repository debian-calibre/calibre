From 91306145806c16884a3b9630bf612567c47c80ef Mon Sep 17 00:00:00 2001
From: Kovid Goyal <kovid@kovidgoyal.net>
Date: Fri, 24 Jul 2020 19:56:18 +0530
Subject: [PATCH 243/284] Clear selection after removing highlight

---
 src/pyj/read_book/create_annotation.pyj | 1 -
 src/pyj/read_book/iframe.pyj            | 3 +++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/pyj/read_book/create_annotation.pyj b/src/pyj/read_book/create_annotation.pyj
index e480f16bd8..5ba0ee7991 100644
--- a/src/pyj/read_book/create_annotation.pyj
+++ b/src/pyj/read_book/create_annotation.pyj
@@ -19,7 +19,6 @@ from widgets import create_button
 # TODO:
 # Custom colors for highlights
 # Export all annots as plain text/JSON
-# Fix selection bar remaining open after removing highlight
 
 
 class AnnotationsManager:
diff --git a/src/pyj/read_book/iframe.pyj b/src/pyj/read_book/iframe.pyj
index d5bc48d99a..8b53287f80 100644
--- a/src/pyj/read_book/iframe.pyj
+++ b/src/pyj/read_book/iframe.pyj
@@ -769,6 +769,9 @@ class IframeBoss:
             if crw_:
                 unwrap_crw(crw_)
                 v'delete annot_id_uuid_map[crw_]'
+                # have to remove selection otherwise it remains as the empty
+                # string, and the selection bar does not hide itself
+                window.getSelection().removeAllRanges()
         elif data.type is 'apply-highlight':
             sel = window.getSelection()
             text = sel.toString()
-- 
2.28.0

