From: YOKOTA Hiroshi <yokota.hgml@gmail.com>
Date: Fri, 27 Dec 2019 15:19:33 +0900
Subject: [PATCH] "ugettext()" is dropped in Python3

Use "gettext()" to get Unicode strings.
---
 src/calibre/translations/dynamic.py |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: b/src/calibre/translations/dynamic.py
===================================================================
--- a/src/calibre/translations/dynamic.py
+++ b/src/calibre/translations/dynamic.py
@@ -1,4 +1,4 @@
-
+from __future__ import absolute_import, division, print_function, unicode_literals
 '''
 Dynamic language lookup of translations for user-visible strings.
 '''
@@ -8,6 +8,7 @@ __copyright__ = '2008, Marshall T. Vande
 
 import io
 from gettext import GNUTranslations
+from calibre.constants import ispy3
 from calibre.utils.localization import get_lc_messages_path
 from zipfile import ZipFile
 
@@ -34,4 +35,5 @@ def translate(lang, text):
                     _CACHE[lang] = trans
     if trans is None:
         return getattr(__builtins__, '_', lambda x: x)(text)
-    return trans.ugettext(text)
+    f = getattr(trans, 'gettext' if ispy3 else 'ugettext')
+    return f(text)
